@for (block of group(); track block.id) {

  <!-- Timeline Division Start Time -->
  @if (
    block.type === DivisionType.eon
      ? direction() === TimelineDirection.chronological || $first
      : direction() === TimelineDirection.chronological && !$first
  ) {
    <ng-template [ngTemplateOutlet]="boundary" [ngTemplateOutletContext]="{text: block.boundary.start}" />
  }
  
  <!-- Timeline Division Container -->
  <div
    [id]="block.id"
    class="division-container type-{{TypeName[block.type] | lowercase}} background-{{block.id}}"
    [ngClass]="{'collapsed': block.isCollapsed}">

    <!-- Timeline Division Header -->
    @if (block.type !== DivisionType.eon && (isDesktop() || block.isCollapsed)) {
      <div class="division-header">
        <div class="division-header-overlay" (click)="toggleBlock(block)"></div>
        @if (isDesktop()) {
          @for (ancestor of block.ancestors; track ancestor.id) {
            <span class="division-ancestor" (click)="$event.stopPropagation()">
              <span class="division-ancestor-title" (click)="navigateToBlock(ancestor)">
                <ng-container>{{ancestor.name}} {{TypeName[ancestor.type]}}</ng-container>
              </span>
            </span>
          }
        }
        <span class="division-title">
          {{block.name}} {{TypeName[block.type]}}
        </span>
      </div>
    }

    @if (!block.isCollapsed) {
      <div class="division-data">

        <div class="division-card">

          <!-- Timeline Division Name and Duration -->
          <div class="division-properties">

            @if (!isMobile() && block.hasImage) {
              <ng-template [ngTemplateOutlet]="collapseButton" [ngTemplateOutletContext]="{block}" />
            }

            <div class="division-name">
              <span>{{block.name}} {{TypeName[block.type]}}</span>
              @if (isMobile() || !block.hasImage) {
                <ng-template [ngTemplateOutlet]="collapseButton" [ngTemplateOutletContext]="{block}" />
              }
            </div>

            <div class="division-duration">
              @for (line of block.duration[direction()]; track $index) {
                <div>{{line}}</div>
              }
            </div>

          </div>
          
          <!-- Timeline Division Image -->
          @if (block.hasImage) {
            <div class="division-image-container">
              <img src="./img/divisions/{{TypeName[block.type] | lowercase}}/{{block.id}}.webp" [alt]="block.name" />
            </div>
          }

        </div>

        <!-- Timeline Division Description -->
        @if (descriptions()![block.id]; as description) {
          <app-description [direction]="direction()" [block]="block" [description]="description" />
        }

      </div>

      <!-- Subdivisions -->
      @if (block.subBlocks.length) {
        @if (isDesktop()) {
          <app-time-scale [direction]="direction()" [block]="block" />
        }
        <div class="subdivisions-container">
          @if (isDesktop()) {
            <div class="vertical-line-container">
              <div class="vertical-line"></div>
            </div>
          }
          <app-division-group [group]="block.subBlocks" [direction]="direction()" />
        </div>
      }
    }
    
  </div>

  <!-- Timeline Division End Time -->
  @if (
    block.type === DivisionType.eon
      ? direction() === TimelineDirection.inverse || $last
      : direction() === TimelineDirection.inverse && !$last
  ) {
    <ng-template [ngTemplateOutlet]="boundary" [ngTemplateOutletContext]="{text: block.boundary.end}" />
  }
}

<!-- Timeline Division Boundary (Start or End Time) Template -->
<ng-template #boundary let-text="text">
  <div class="boundary">
    <div class="boundary-line"></div>
    <div class="boundary-value">{{text}}</div>
    <div class="boundary-line"></div>
  </div>
</ng-template>

<!-- Collapse Button Template -->
<ng-template #collapseButton let-block="block">
  @if (block.type !== DivisionType.eon && !isDesktop()) {
    <button 
      type="button"
      class="division-collapse-button"
      [ngClass]="{'button-above': block.hasImage && !isMobile()}"
      (click)="toggleBlock(block)">
      <ng-container>&#9650;</ng-container>
    </button>
  }
</ng-template>